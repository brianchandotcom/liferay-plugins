<?xml version="1.0"?>
<!DOCTYPE project>

<project name="rtl-hook" basedir="." default="deploy">
	<import file="../build-common-hook.xml" />

	<target name="build-rtl-css" depends="clean-rtl-css,compile">
		<java
			classname="com.liferay.rtl.tools.RtlCssBuilder"
			classpathref="plugin.classpath"
			fork="true"
			newenvironment="true"
		>
			<jvmarg value="-Dliferay.lib.portal.dir=${app.server.lib.portal.dir}" />
			<arg value="sass.dir=/" />
			<arg value="sass.docroot.dir=${basedir}/docroot" />
		</java>
	</target>

	<target name="clean">
		<var name="custom-jsps.tmp.dir" value="${basedir}/custom_jsps_tmp" />

		<mkdir dir="@{custom-jsps.tmp.dir}" />

		<move todir="@{custom-jsps.tmp.dir}" file="${basedir}/docroot/META-INF/custom_jsps/html" />

		<clean module.dir="${basedir}" />

		<move todir="${basedir}/docroot/META-INF/custom_jsps" file="@{custom-jsps.tmp.dir}/html" />

		<delete dir="@{custom-jsps.tmp.dir}" />
	</target>

	<target name="clean-rtl-css">
		<delete failonerror="false" includeemptydirs="true">
			<fileset dir="${basedir}/docroot" includes="**/.sass-cache/*_rtl.*" />
		</delete>
	</target>

	<target name="compile" depends="build-common.compile,rtl-jar" />

	<target name="rtl-jar">
		<zip
			basedir="docroot/WEB-INF/classes"
			destfile="docroot/WEB-INF/lib/${plugin.name}.jar"
		/>
	</target>

	<target name="update-from-portal">
		<copy overwrite="true" preservelastmodified="true" todir="docroot/META-INF/custom_jsps">
			<fileset
				dir="${app.server.portal.dir}"
				excludes="**/_diffs/**"
				includes="**/*.css"
			/>
		</copy>
	</target>
</project>